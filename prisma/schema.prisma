// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin Role Enum
enum AdminRole {
  SUPER_ADMIN
  ADMIN
  EDITOR
}

// Column Status Enum
enum ColumnStatus {
  DRAFT
  PUBLISHED
  PRIVATE
}

// Page Content Type Enum
enum ContentType {
  TEXT
  HTML
  JSON
  IMAGE
}

// Admin (어드민 계정)
model Admin {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String    // hashed password
  name        String
  role        AdminRole @default(EDITOR)
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  columns     Column[]
  media       Media[]

  @@map("admins")
}

// Category (카테고리)
model Category {
  id          String    @id @default(uuid())
  name        String    @unique
  slug        String    @unique
  description String?
  parentId    String?   // 계층형 카테고리용
  order       Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  parent      Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  columns     Column[]

  @@map("categories")
}

// Tag (태그)
model Tag {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  columns   ColumnTag[]

  @@map("tags")
}

// Column (칼럼/게시글)
model Column {
  id           String        @id @default(uuid())
  title        String
  slug         String        @unique
  content      String        @db.Text
  excerpt      String?       @db.Text
  thumbnailUrl String?
  status       ColumnStatus  @default(DRAFT)
  authorId     String
  categoryId   String?
  viewCount    Int           @default(0)
  publishedAt  DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  // Relations
  author       Admin         @relation(fields: [authorId], references: [id], onDelete: Cascade)
  category     Category?     @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tags         ColumnTag[]

  @@index([status])
  @@index([categoryId])
  @@index([authorId])
  @@index([publishedAt])
  @@map("columns")
}

// ColumnTag (다대다 관계)
model ColumnTag {
  id       String   @id @default(uuid())
  columnId String
  tagId    String
  createdAt DateTime @default(now())

  // Relations
  column   Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)
  tag      Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([columnId, tagId])
  @@map("column_tags")
}

// PageContent (홈페이지 컨텐츠)
model PageContent {
  id        String      @id @default(uuid())
  key       String      @unique
  title     String?
  content   String      @db.Text
  type      ContentType @default(TEXT)
  isActive  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("page_contents")
}

// Media (미디어 파일)
model Media {
  id           String   @id @default(uuid())
  originalName String
  fileName     String
  mimeType     String
  size         Int      // bytes
  url          String
  uploadedBy   String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  uploader     Admin    @relation(fields: [uploadedBy], references: [id], onDelete: Cascade)

  @@index([uploadedBy])
  @@map("media")
}

